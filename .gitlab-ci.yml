stages:
  - Static Analysis
  - Unit Test
  - Build

pylint:
  stage: Static Analysis
  image: "python:3.8"
  before_script:
    - python --version
    - python setup.py develop
    - pip install pylint
  tags:
    - shared
  script:
    - pylint src
    - pylint --rcfile tests/.pylintrc tests

black:
  stage: Static Analysis
  image: "python:3.8"
  before_script:
    - pip install -r requirements.txt
    - pip install black
  tags:
    - shared
  script:
    - black --check src
    - black --check tests

test:
  stage: Unit Test
  image: "python:3.8"
  needs: []
  before_script:
    - python --version
    - pip install -r requirements.txt
    - pip install -r tests/testrequirements.txt
  tags:
    - shared
  artifacts:
    reports:
      junit: junit.xml
      cobertura: coverage.xml
  script:
    - python setup.py develop
    - python setup.py test

build:
  stage: Build
  image: "python:3.8"
  needs:
    - test
    - black
    - pylint
  before_script:
    - pip install -r requirements.txt
    - pip install wheel
  tags:
    - shared
  artifacts:
    paths:
      - dist/*.whl
  script:
    - python setup.py sdist bdist_wheel
